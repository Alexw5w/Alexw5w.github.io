{
  "hash": "8a95f2d9afca4ed5daacaf4eff3bb94a",
  "result": {
    "markdown": "---\ntitle: \"二分类变量的网络分析\"\nformat: html\neditor: visual\n---\n\n\n### 1 简介\n\n如果网络分析的对象是二元分类变量，那么就需要使用到一个叫做**Ising**的模型。Ising模型是描述由二分类变量组成的系统的一种概率模型。它假设系统中的每个节点（变量）只能取二值状态（例如，-1 或 +1，对应于我们常见的 0/1 编码），并通过一种邻接结构来描述这些变量的相互作用。\n\n-   **节点（variables）**：表示二分类变量，如某个人在某一特定时间点上的情绪是否为积极或消极，某一疾病症状是否存在，等等。\n\n-   **边（edges）**：表示两个二分类变量之间的相互作用，通常由条件依赖关系建模。\n\n-   **配合外部场（external field）**：描述每个变量单独的偏好或倾向。\n\nIsing模型的目标是捕捉这些变量之间的相互影响，并揭示它们的网络结构。\n\n说起来比较复杂，为了方便理解，你可以将其理解成一组logistic回归模型。\n\n### 2 R语言示例\n\n在 R 中，可以使用 `IsingFit` 或 `mgm` 包来拟合 Ising 模型，并分析二分类变量的网络结构。\n\n#### 2.1 使用 IsingFit\n\n先导入包\n\n\n\n\n\n模拟一份数据，用于拟合网络模型。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyData = read.table('https://www.statmodel.com/usersguide/chap7/ex7.4.dat',col.names = c(\"x1\", \"x2\", \"x3\", \"x4\",\"other\"))\ndata = myData[,1:4]\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  x1 x2 x3 x4\n1  0  1  0  1\n2  1  0  1  0\n3  0  0  1  1\n4  1  1  1  0\n5  1  1  1  0\n6  0  1  1  0\n```\n:::\n:::\n\n\n拟合模型：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 拟合 Ising 模型\nfit = IsingFit(data, family = \"binomial\",plot = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output-display}\n![](二分类变量网络分析_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# 查看拟合结果\nprint(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nEstimated network:\n      x1    x2    x3    x4\nx1  0.00  0.81 -0.74 -0.58\nx2  0.81  0.00 -0.50 -0.66\nx3 -0.74 -0.50  0.00  0.00\nx4 -0.58 -0.66  0.00  0.00\n\n\nEstimated Thresholds:\n       x1        x2        x3        x4 \n0.2732235 0.1802154 0.4938531 0.2786882 \n```\n:::\n:::\n\n\n出来的图连线比较少，可能与随机模拟的数据本身有关。这个图与我们提取关系矩阵用qgraph画图是一样的\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqgraph(fit$weiadj,layout = 'spring')\n```\n\n::: {.cell-output-display}\n![](二分类变量网络分析_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n可以继续计算中心性：\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncentrality(fit$weiadj)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$OutDegree\n      x1       x2       x3       x4 \n2.122048 1.963616 1.239084 1.233761 \n\n$InDegree\n      x1       x2       x3       x4 \n2.122048 1.963616 1.239084 1.233761 \n\n$Closeness\n       x1        x2        x3        x4 \n0.2310618 0.2099911 0.1552461 0.1576292 \n\n$Betweenness\nx1 x2 x3 x4 \n 2  0  0  0 \n\n$InExpectedInfluence\n        x1         x2         x3         x4 \n-0.5092286 -0.3507965 -1.2390835 -1.2337609 \n\n$OutExpectedInfluence\n        x1         x2         x3         x4 \n-0.5092286 -0.3507965 -1.2390835 -1.2337609 \n\n$ShortestPathLengths\n         x1       x2       x3       x4\nx1 0.000000 1.240065 1.352540 1.735242\nx2 1.240065 0.000000 2.001065 1.520977\nx3 1.352540 2.001065 0.000000 3.087782\nx4 1.735242 1.520977 3.087782 0.000000\n\n$ShortestPaths\n   x1   x2   x3   x4  \nx1 NULL NULL NULL NULL\nx2 NULL NULL NULL NULL\nx3 NULL NULL NULL NULL\nx4 NULL NULL NULL NULL\n```\n:::\n:::\n\n\n绘制中心性图：\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncentralityPlot(fit$weiadj, \n               include=c(\"Strength\",'Closeness',\"Betweenness\"))\n```\n\n::: {.cell-output-display}\n![](二分类变量网络分析_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n#### 2.2 使用mgm\n\n这个也是非常简单的，几行代码可以搞定：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 使用 mgm 包拟合 Ising 模型\n# 二分类变量用 type = \"c\" 表示 (category)\nfit_mgm = mgm(data = as.matrix(data), \n               type = rep(\"c\", 4), \n               level = rep(2, 4),  # 2 表示二分类变量\n               lambdaSel = \"EBIC\",  # 使用 EBIC 选择正则化参数\n               ruleReg = \"OR\")  # 使用 OR 规则连接\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |------------------                                                    |  25%\n  |                                                                            \n  |-----------------------------------                                   |  50%\n  |                                                                            \n  |----------------------------------------------------                  |  75%\n  |                                                                            \n  |----------------------------------------------------------------------| 100%\nNote that the sign of parameter estimates is stored separately; see ?mgm\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 查看权重领接矩阵\nprint(fit_mgm$pairwise$wadj)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          [,1]      [,2]       [,3]       [,4]\n[1,] 0.0000000 0.4032047 0.36967042 0.28814441\n[2,] 0.4032047 0.0000000 0.24986795 0.32873615\n[3,] 0.3696704 0.2498679 0.00000000 0.05342224\n[4,] 0.2881444 0.3287361 0.05342224 0.00000000\n```\n:::\n:::\n\n\n可视化：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqgraph(fit_mgm$pairwise$wadj,\n       edge.color = fit_mgm$pairwise$edgecolor,\n       layout = \"spring\",\n       labels =  autism_data$colnames)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in mapply(strwidth, s = labels, cex = ones): longer argument not a\nmultiple of length of shorter\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in pmax(sapply(ones, function(x) strwidth(label.norm, cex = x)), : an\nargument will be fractionally recycled\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in mapply(strheight, s = labels, cex = ones): longer argument not a\nmultiple of length of shorter\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in pmax(sapply(ones, function(x) strheight(label.norm, cex = x)), : an\nargument will be fractionally recycled\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in (VWidths * label.fill.horizontal)/LWidths: longer object length is\nnot a multiple of shorter object length\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in (VHeights * label.fill.vertical)/LHeights: longer object length is\nnot a multiple of shorter object length\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in label.cex * label.prop * pmin((VWidths *\nlabel.fill.horizontal)/LWidths, : longer object length is not a multiple of\nshorter object length\n```\n:::\n\n::: {.cell-output-display}\n![](二分类变量网络分析_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n计算中心性：\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncentrality(fit_mgm$pairwise$wadj)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$OutDegree\n[1] 1.0610195 0.9818088 0.6729606 0.6703028\n\n$InDegree\n[1] 1.0610195 0.9818088 0.6729606 0.6703028\n\n$Closeness\n[1] 0.11553048 0.10499573 0.07762275 0.07881444\n\n$Betweenness\n[1] 2 0 0 0\n\n$InExpectedInfluence\n[1] 1.0610195 0.9818088 0.6729606 0.6703028\n\n$OutExpectedInfluence\n[1] 1.0610195 0.9818088 0.6729606 0.6703028\n\n$ShortestPathLengths\n         [,1]     [,2]     [,3]     [,4]\n[1,] 0.000000 2.480130 2.705112 3.470482\n[2,] 2.480130 0.000000 4.002114 3.041953\n[3,] 2.705112 4.002114 0.000000 6.175594\n[4,] 3.470482 3.041953 6.175594 0.000000\n\n$ShortestPaths\n     [,1] [,2] [,3] [,4]\n[1,] NULL NULL NULL NULL\n[2,] NULL NULL NULL NULL\n[3,] NULL NULL NULL NULL\n[4,] NULL NULL NULL NULL\n```\n:::\n:::\n\n\n绘制中心性：\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncentralityPlot(fit_mgm$pairwise$wadj,\n               include=c(\"Strength\",'ExpectedInfluence',\n                            'Closeness',\"Betweenness\"))\n```\n\n::: {.cell-output-display}\n![](二分类变量网络分析_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n**运行环境：**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.2 (2023-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64 (64-bit)\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=Chinese (Simplified)_China.utf8 \n[2] LC_CTYPE=Chinese (Simplified)_China.utf8   \n[3] LC_MONETARY=Chinese (Simplified)_China.utf8\n[4] LC_NUMERIC=C                               \n[5] LC_TIME=Chinese (Simplified)_China.utf8    \n\ntime zone: Asia/Shanghai\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] mgm_1.2-14   qgraph_1.9.8 IsingFit_0.4\n\nloaded via a namespace (and not attached):\n [1] shape_1.4.6       gtable_0.3.4      xfun_0.41         ggplot2_3.5.0    \n [5] htmlwidgets_1.6.2 psych_2.3.9       lattice_0.21-9    quadprog_1.5-8   \n [9] vctrs_0.6.4       tools_4.3.2       generics_0.1.3    stats4_4.3.2     \n[13] parallel_4.3.2    tibble_3.2.1      fansi_1.0.5       cluster_2.1.4    \n[17] pkgconfig_2.0.3   Matrix_1.6-5      data.table_1.15.4 checkmate_2.3.0  \n[21] lifecycle_1.0.4   farver_2.1.1      compiler_4.3.2    stringr_1.5.1    \n[25] munsell_0.5.0     mnormt_2.1.1      codetools_0.2-19  htmltools_0.5.7  \n[29] glasso_1.11       fdrtool_1.2.17    yaml_2.3.7        glmnet_4.1-8     \n[33] htmlTable_2.4.2   Formula_1.2-5     pillar_1.9.0      Hmisc_5.1-1      \n[37] iterators_1.0.14  rpart_4.1.21      abind_1.4-5       foreach_1.5.2    \n[41] nlme_3.1-163      lavaan_0.6-17     gtools_3.9.5      tidyselect_1.2.0 \n[45] digest_0.6.33     stringi_1.8.1     dplyr_1.1.4       reshape2_1.4.4   \n[49] labeling_0.4.3    splines_4.3.2     fastmap_1.1.1     grid_4.3.2       \n[53] colorspace_2.1-0  cli_3.6.2         magrittr_2.0.3    base64enc_0.1-3  \n[57] survival_3.5-7    utf8_1.2.4        pbivnorm_0.6.0    withr_2.5.2      \n[61] foreign_0.8-85    corpcor_1.6.10    scales_1.3.0      backports_1.4.1  \n[65] rmarkdown_2.25    jpeg_0.1-10       igraph_2.0.1.1    nnet_7.3-19      \n[69] gridExtra_2.3     png_0.1-8         pbapply_1.7-2     evaluate_0.23    \n[73] knitr_1.45        rlang_1.1.3       Rcpp_1.0.11       glue_1.6.2       \n[77] rstudioapi_0.16.0 jsonlite_1.8.7    R6_2.5.1          plyr_1.8.9       \n```\n:::\n:::\n",
    "supporting": [
      "二分类变量网络分析_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}